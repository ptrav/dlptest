<!-- 
 @file custom.html
 @description Results page with the user-selected PII categories from the landing page
 @author Phil Traversa
 @license https://www.gnu.org/licenses/agpl-3.0.txt
 @requires style.css
 @requires theme.js
 @requires helpers.js
 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DLP Test Case: Custom Selection of PII</title>
    <link rel="stylesheet" href="css/style.css">
    <meta name="description" content="A tool to generate pages with various types of PII for verifying DLP software functionality. This page contains user-selected PII types.">
    <script src="js/theme.js"></script>
</head>
<body class="results-page">
    <header>
        <div class="container">
            <div class="header-content">
                <h1><a href="index.html">DLP Test Suite üïµÔ∏è</a></h1>
                <p><b>A tool to generate pages with various PII for verifying DLP software functionality.</b><br>Any similarity to actual persons or their data, living or dead, is purely coincidental.</p>
            </div>
            <div class="theme-switch-wrapper">
                <span>‚òÄÔ∏è</span>
                <label class="theme-switch" for="theme-toggle">
                    <input type="checkbox" id="theme-toggle" />
                    <span class="slider"></span>
                </label>
                <span>üåô</span>
            </div>
        </div>
    </header>

    <main class="container">
        <nav class="breadcrumb">
            <a href="index.html">&larr; Back to Generator</a>
        </nav>
        <section class="test-section">
            <h2>Test Case: User-selected Custom PII</h2>
            <p>The following table contains the PII data you previously selected for testing:</p>
            <div id="results-container" class="table-wrapper" role="region" aria-live="polite">
                <p>Generating data...</p>
            </div>
        </section>
    </main>
    
    <footer>
        <div class="container">
            <p>Made with <svg class="footer-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M241 87.1l15 20.7 15-20.7C296 52.5 336.2 32 378.9 32 452.4 32 512 91.6 512 165.1l0 2.6c0 112.2-139.9 242.5-212.9 298.2-12.4 9.4-27.6 14.1-43.1 14.1s-30.8-4.6-43.1-14.1C139.9 410.2 0 279.9 0 167.7l0-2.6C0 91.6 59.6 32 133.1 32 175.8 32 216 52.5 241 87.1z"/></svg>            in Chicago |  ¬© 2025 <a href="https://github.com/ptrav/dlptest" target="_blank" rel="external" style="color:#8b949e">Phil Traversa</a><br>Licensed under <a href="https://www.gnu.org/licenses/agpl-3.0.txt" target="_blank" rel="external" style="color:#8b949e">AGPLv3</a> with Font Awesome icongraphy under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="external" style="color:#8b949e">CC BY 4.0</a><br>Visa, Mastercard, American Express, and Discover card logos are trademarked by their respective owners and displayed under <i>nominative fair use</i></p>
        </div>
    </footer>

    <script src="js/helpers.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const resultsContainer = document.getElementById('results-container');
            
            if (!window.dlpTestHelpers) {
                resultsContainer.innerHTML = '<p class="error"><strong>FATAL:</strong> A critical file (helpers.js) is missing.</p>';
                return;
            }

            const storedPayload = sessionStorage.getItem('dlpTestPayload');
            if (!storedPayload) {
                resultsContainer.innerHTML = '<p class="error"><strong>Error:</strong> No session data found. Please generate a new test from the main page.</p>';
                return;
            }

            try {
                const payload = JSON.parse(storedPayload);
                const data = payload.data;
                const headers = payload.headers;
                
                // standard tooltip content
                const tooltipContent = {
                    'Credit Card Number': 'CCNs are checksummed with the Luhn algorithm.<br><br>Supported card types: Visa, Mastercard, American Express, and Discover Card',
                    'Driver\'s License': 'DL numbers are uniquely generated per state formatting requirements and paired with last names.<br><br>Currently implemented: CA, TX, FL, IL, NY',
                    'ACH Banking Info': 'Consists of assigned ABA 9-digit routing transit numbers paired with fictious 8 to 17 digit account numbers.',
                    'ICD-10-CM Diagnosis Code': 'ICD-10 is a medical coding system used to classify health conditions and clinical procedures for claims processing with the \'CM\' codeset used for medical diagnoses.<br><br>The \'7th character\' used in some cases is not implemented in this test. Data is from the FY26 code update effective on Oct 1, 2025.',
                };

                // check for HARD MODE and make modifications if so
                if (payload.isHardMode) {
                    const mainHeading = document.querySelector('.test-section h2');
                    if(mainHeading) {
                        mainHeading.innerHTML = '<span class="hard-mode-red">HARD MODE:</span> Potentially Bogus Credit Card Numbers';
                    }
                    tooltipContent['Credit Card Number'] = '<span class="hard-mode-red"><b>HARD MODE enabled</b></span><br><br>Your DLP software may be fooled by simultaneously valid yet invalid CCNs.<br><br><i>Go back to the landing page to revert back to normal mode</i>';
                }

                const table = document.createElement('table');
                const thead = document.createElement('thead');
                const tbody = document.createElement('tbody');
                const headerRow = document.createElement('tr');

                headers.forEach(headerText => {
                    const th = document.createElement('th');
                    th.scope = 'col';
                    if (tooltipContent[headerText]) {
                        th.innerHTML = `${headerText} <span class="tooltip-container"><span class="tooltip-icon">‚ìò</span><div class="tooltip-content" style="display: none;">${tooltipContent[headerText]}</div></span>`;
                    } else {
                        th.textContent = headerText;
                    }
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);

                data.forEach(rowData => {
                    const row = document.createElement('tr');
                    headers.forEach(header => {
                        const dataKey = header.toLowerCase().replace(/[^a-z0-9]/g, ''); 
                        const cell = document.createElement('td');
                        cell.dataset.label = header;
                        let cellValue = rowData[dataKey];
                        
                        if (header === 'Credit Card Number' && cellValue) {
                            cell.innerHTML = window.dlpTestHelpers.formatCCN(cellValue);
                        } else if (header === 'ICD-10-CM Diagnosis Code' && cellValue && cellValue.includes(' ')) {
                            const firstSpaceIndex = cellValue.indexOf(' ');
                            const code = cellValue.substring(0, firstSpaceIndex);
                            const description = cellValue.substring(firstSpaceIndex + 1);
                            cell.innerHTML = `<strong>${code}</strong> ${description}`;
                        } else {
                            cell.textContent = cellValue || 'N/A';
                        }
                        
                        row.appendChild(cell);
                    });
                    tbody.appendChild(row);
                });

                table.appendChild(thead);
                table.appendChild(tbody);
                resultsContainer.innerHTML = '';
                resultsContainer.appendChild(table);
                
                window.dlpTestHelpers.addTooltipEvents();
                window.dlpTestHelpers.autoExpandContainer();

            } catch (error) {
                console.error('Failed to parse or render data:', error);
                resultsContainer.innerHTML = '<p class="error"><strong>Error:</strong> Could not display data.</p>';
            }
        });
    </script>
</body>
</html>
